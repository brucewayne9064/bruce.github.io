<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>软路由科学上网和自动化脚本编写使用 | BRUCE</title><meta name="author" content="Bruce"><meta name="copyright" content="Bruce"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="红米AX6S路由器，刷入openwrt，实现翻墙和网络认证自动登录">
<meta property="og:type" content="article">
<meta property="og:title" content="软路由科学上网和自动化脚本编写使用">
<meta property="og:url" content="https://brucewayne9064.github.io/2024/08/16/%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/%E8%BD%AF%E8%B7%AF%E7%94%B1%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99%E4%BD%BF%E7%94%A8/index.html">
<meta property="og:site_name" content="BRUCE">
<meta property="og:description" content="红米AX6S路由器，刷入openwrt，实现翻墙和网络认证自动登录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg">
<meta property="article:published_time" content="2024-08-15T17:37:01.000Z">
<meta property="article:modified_time" content="2024-08-16T16:08:43.087Z">
<meta property="article:author" content="Bruce">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="软路由">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><link rel="shortcut icon" href="/img/bat_logo.png"><link rel="canonical" href="https://brucewayne9064.github.io/2024/08/16/%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/%E8%BD%AF%E8%B7%AF%E7%94%B1%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99%E4%BD%BF%E7%94%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '软路由科学上网和自动化脚本编写使用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-17 00:08:43'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/sanji_avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="BRUCE"><img class="site-icon" src="/img/bat_logo_big.png"/><span class="site-name">BRUCE</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">软路由科学上网和自动化脚本编写使用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-15T17:37:01.000Z" title="发表于 2024-08-16 01:37:01">2024-08-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-16T16:08:43.087Z" title="更新于 2024-08-17 00:08:43">2024-08-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/">软件使用</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>18分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="软路由科学上网和自动化脚本编写使用"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>为了实现校园网自动登录验证以及路由器翻墙功能，参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_66984299/article/details/133325819">这篇文章</a>和<a target="_blank" rel="noopener" href="https://sspai.com/post/57882">这篇文章</a>进行操作。路由器是红米AX6S，电脑用的是一台macos和一台Windows。我的github仓库为 <a target="_blank" rel="noopener" href="https://github.com/brucewayne9064/AutoCampusNetAuth">https://github.com/brucewayne9064/AutoCampusNetAuth</a></p>
<h2 id="1-给路由器刷入openwrt"><a href="#1-给路由器刷入openwrt" class="headerlink" title="1. 给路由器刷入openwrt"></a>1. 给路由器刷入openwrt</h2><p>参考<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=VkyIEuk6V5k">这位大佬的视频</a>完成刷机，第一次刷好后发现他的固件没有openclash，但是我自己又装不上，所以又找其他教程。这个youtuber的<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=V0rZ26Rhhd4">视频</a>里的固件是有openssh的，<strong>所以最后采用他的固件</strong>，前面的步骤和第一位一样。</p>
<h3 id="1-1-准备工具"><a href="#1-1-准备工具" class="headerlink" title="1.1 准备工具"></a>1.1 准备工具</h3><p>在<strong>刷机要用到的固件和工具</strong>目录中，有如下内容：</p>
<ul>
<li><p>miwifi_rb03_firmware_stable_1.2.7（内测版）测试固件，可以开启路由器telnet功能。</p>
</li>
<li><p>MobaXterm_Portable_v23.0 工具，作用是通过telnet协议或者ssh协议登录路由器执行命令，上传openwrt固件到路由器。</p>
</li>
<li><p>计算root密码工具，首先在浏览器输入192.168.31.1登录路由器后台管理页面，复制首页的SN码，进入到提供的计算root密码的网站，输入SN码，计算得到密码。</p>
</li>
<li><p>openwrt固件</p>
<ul>
<li>原版：只能有线登录，配置复杂，系统纯净</li>
<li>新手版：做好配置的版本</li>
</ul>
</li>
</ul>
<p>在<strong>telent命令</strong>目录中，存放着在建立telnet连接后要执行的命令。</p>
<h3 id="1-2-刷机过程"><a href="#1-2-刷机过程" class="headerlink" title="1.2 刷机过程"></a>1.2 刷机过程</h3><ul>
<li>选择系统升级-手动升级，把miwifi_rb03_firmware_stable_1.2.7刷入。</li>
</ul>
<p>  升级过程中路由器亮黄灯，升级完成变成蓝灯，此时刷新后台页面重新登录即可，这时候会发现固件版本已经变成miwifi开发版1.2.7。</p>
<ul>
<li><p>使用MobaXterm_Portable_v23.0登录路由器，因为这个是win版软件，我这里用macos的Termius，win的Xshell应该也可以。</p>
<p>因为还没有配置ssh，所以这边先用telnet协议登录。输入后台的ip进行连接，连接成功之后要输入用户名和密码。用户名是root，密码是root密码工具用sn码计算出来的密码（注意在命令行中密码一般是不显示的）。当你看到这个界面说明成功了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">BusyBox v1.25.1 (2021-10-25 11:02:56 UTC) built-in shell (ash)</span><br><span class="line"></span><br><span class="line"> -----------------------------------------------------</span><br><span class="line">       Welcome to XiaoQiang!</span><br><span class="line"> -----------------------------------------------------</span><br><span class="line"><span class="meta prompt_">  $</span><span class="language-bash">$$$$$\  $$$$$$$\  $$$$$$$$\      $$\      $$\        $$$$$$\  $$\   $$\</span></span><br><span class="line"><span class="language-bash"> $$  __$$\ $$  __$$\ $$  _____|     $$ |     $$ |      $$  __$$\ $$ | $$  |</span></span><br><span class="line"><span class="meta prompt_"> $</span><span class="language-bash">$ /  $$ |$$ |  $$ |$$ |           $$ |     $$ |      $$ /  $$ |$$ |$$  /</span></span><br><span class="line"><span class="meta prompt_"> $</span><span class="language-bash">$$$$$$$ |$$$$$$$  |$$$$$\         $$ |     $$ |      $$ |  $$ |$$$$$  /</span></span><br><span class="line"><span class="meta prompt_"> $</span><span class="language-bash">$  __$$ |$$  __$$&lt; $$  __|        $$ |     $$ |      $$ |  $$ |$$  $$&lt;</span></span><br><span class="line"><span class="meta prompt_"> $</span><span class="language-bash">$ |  $$ |$$ |  $$ |$$ |           $$ |     $$ |      $$ |  $$ |$$ |\$$\</span></span><br><span class="line"><span class="language-bash"> $$ |  $$ |$$ |  $$ |$$$$$$$$\       $$$$$$$$$  |       $$$$$$  |$$ | \$$\</span></span><br><span class="line"><span class="language-bash"> \__|  \__|\__|  \__|\________|      \_________/        \______/ \__|  \__|</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@XiaoQiang:~# </span><br></pre></td></tr></table></figure>
</li>
<li><p>执行telnet命令。可以用GPT看看都是什么作用，大概来说都是NVRAM（非易失性随机存取存储器）设置。SSH功能也开启了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nvram set ssh_en=1 &amp;&amp; nvram set uart_en=1 &amp;&amp; nvram set boot_wait=on &amp;&amp; nvram set bootdelay=3 &amp;&amp; nvram set flag_try_sys1_failed=0 &amp;&amp; nvram set flag_try_sys2_failed=1</span><br><span class="line"></span><br><span class="line">nvram set flag_boot_rootfs=0 &amp;&amp; nvram set &quot;boot_fw1=run boot_rd_img;bootm&quot;</span><br><span class="line"></span><br><span class="line">nvram set flag_boot_success=1 &amp;&amp; nvram commit &amp;&amp; /etc/init.d/dropbear enable &amp;&amp; /etc/init.d/dropbear start</span><br></pre></td></tr></table></figure>
</li>
<li><p>在Termius中用ssh建立连接。进入tmp目录，上传新手版固件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp</span><br></pre></td></tr></table></figure>

<p><strong>最终发现Termius或者XFTP都不能用sftp协议建立连接，所以最后还是只能找了台Windows，用MobaXterm把文件上传到tmp目录。</strong></p>
</li>
<li><p>使用mtd命令刷机，第一次刷入的叫做底包。</p>
<p>其中-r参数表示更新完自动重启。等待路由器黄灯变蓝灯。根据新手版的说明，刷机成功后，默认WiFi名称：Openwrt_5G ; Openwrt_2.4G 。 密码：无（但是Openwrt_2.4G好像有密码，不知道是多少）。这个固件的初始登陆ip是：192.168.6.1，用户名是：root，密码是：password。再刷入upgrade.bin文件（第二次刷入的叫升级包）可以升级系统(选择不保留配置)。升级的系统自带的功能变多了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mtd -r write /tmp/factory.bin firmware</span><br></pre></td></tr></table></figure>

<p>但是在这里遇到一点问题，就是刷入新系统之后安装openclash需要的依赖装不上，提示内核版本不对，还有就是ssh也出问题连不上，所以这里先考虑下一步刷回原厂系统，再重新来一次，使用前面说的另一个版本固件。</p>
</li>
<li><p>刷回原厂系统</p>
<ul>
<li>准备两个工具，在<a target="_blank" rel="noopener" href="https://www.miwifi.com/miwifi_download.html">官网</a>可以找到，分别是小米路由器修复工具和AX6S官方固件。</li>
<li>关闭Windows防火墙和病毒保护。</li>
<li><strong>路由器连接网线到电脑</strong>，根据软件提示进行操作 ，选择对应的网口，然后写入文件，然后按住复位按钮，拔掉电源再插上，直到橙灯闪烁，松开复位键即可。</li>
</ul>
</li>
</ul>
<h2 id="2-配置翻墙"><a href="#2-配置翻墙" class="headerlink" title="2.配置翻墙"></a>2.配置翻墙</h2><h3 id="2-1-刷入的固件自带openclash"><a href="#2-1-刷入的固件自带openclash" class="headerlink" title="2.1 刷入的固件自带openclash"></a>2.1 刷入的固件自带openclash</h3><p>OpenClash是一个运行在 OpenWrt 上的 Clash 客户端，兼容 Shadowsocks(R)、Vmess、Trojan、Snell 等协议，根据灵活的规则配置实现策略代理。参考<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=_U9uXhoyaeE">这个视频</a>进行配置。我买的订阅是是<a target="_blank" rel="noopener" href="https://tagss04.pro/#/home">TAGInternet</a>的。</p>
<ul>
<li><p>选择配置文件订阅-添加</p>
</li>
<li><p>从机场复制订阅链接</p>
</li>
<li><p>修改配置文件名-粘贴订阅地址</p>
</li>
<li><p>保存配置-更新配置</p>
</li>
<li><p>插件设置-版本更新-更新内核（根据<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=bVPp9HaxDLU&t=188s">这个</a>设置成功的）</p>
</li>
<li><p>显示主程序运行中即成功</p>
</li>
<li><p>如果网站访问检查里面Youtube显示无法连接，说明订阅里面没有开启对应节点而是选择的direct</p>
<ul>
<li>代理模式选择规则。</li>
<li>打开YACD控制面板或者DashBoard控制面板，然后把selecter选择为其他结点就行了。</li>
</ul>
</li>
</ul>
<h3 id="2-2-刷入的固件没有openclash（没有验证成功）"><a href="#2-2-刷入的固件没有openclash（没有验证成功）" class="headerlink" title="2.2 刷入的固件没有openclash（没有验证成功）"></a>2.2 刷入的固件没有openclash（没有验证成功）</h3><p> <a target="_blank" rel="noopener" href="https://github.com/vernesong/OpenClash">OpenClash</a> 的官方仓库中有详细的说明文档。大致来说分为以下几个步骤：</p>
<blockquote>
<p>#安装依赖</p>
<ul>
<li>luci</li>
<li>luci-base</li>
<li>iptables</li>
<li>dnsmasq-full</li>
<li>coreutils</li>
<li>coreutils-nohup</li>
<li>bash</li>
<li>curl</li>
<li>jsonfilter</li>
<li>ca-certificates</li>
<li>ipset</li>
<li>ip-full</li>
<li>iptables-mod-tproxy</li>
<li>kmod-tun(TUN模式)</li>
<li>luci-compat(Luci-19.07)</li>
</ul>
<p>#上传IPK文件至您路由器的 &#x2F;tmp 目录下</p>
<p>#假设安装包名字为<br>luci-app-openclash_0.33.7-beta_all.ipk</p>
<p>#执行安装命令<br>opkg install &#x2F;tmp&#x2F;luci-app-openclash_0.33.7-beta_all.ipk</p>
<p>#执行卸载命令<br>#插件在卸载后会自动备份配置文件到 &#x2F;tmp 目录下，除非路由器重启，在下次安装时将还原您的配置文件<br>opkg remove luci-app-openclash</p>
<p>安装完成后刷新LUCI页面，在菜单栏 -&gt; 服务 -&gt; OpenClash 进入插件页面</p>
</blockquote>
<h2 id="3-校园网自动登录"><a href="#3-校园网自动登录" class="headerlink" title="3. 校园网自动登录"></a>3. 校园网自动登录</h2><h3 id="3-1-抓取登录链接"><a href="#3-1-抓取登录链接" class="headerlink" title="3.1 抓取登录链接"></a>3.1 抓取登录链接</h3><p>连接要实现自动登录的无线网，保持未登录状态，现在找不到。经过一次断链后发现ip地址是172.25.249.70。</p>
<p>以chrome浏览器为例，按F12打开开发者模式，选择network，录制，勾选preserve log，点击登录，查看抓取的内容。原文的抓取到的登录链接是get方式传输的请求，参数在url里面，我们学校的是post方法传输的request，参数在body里面，所以不能直接用抓取到的链接进行登录。</p>
<ul>
<li><p>找到请求后，右键单击选择copy -&gt; copy as cURL，复制到vscode里面，进行下一步处理。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;http://172.25.249.70/eportal/InterFace.do?method=login&#x27; \</span><br><span class="line">  -H &#x27;Accept: */*&#x27; \</span><br><span class="line">  -H &#x27;Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6&#x27; \</span><br><span class="line">  -H &#x27;Connection: keep-alive&#x27; \</span><br><span class="line">  -H &#x27;Content-Type: application/x-www-form-urlencoded; charset=UTF-8&#x27; \</span><br><span class="line">  -H &#x27;Cookie: EPORTAL_COOKIE_USERNAME=宽带账号; EPORTAL_COOKIE_SERVER=; EPORTAL_COOKIE_DOMAIN=; EPORTAL_COOKIE_SAVEPASSWORD=true; EPORTAL_COOKIE_OPERATORPWD=; EPORTAL_COOKIE_NEWV=true; EPORTAL_COOKIE_PASSWORD=宽带密码; EPORTAL_AUTO_LAND=; EPORTAL_USER_GROUP=%E7%94%B5%E5%AD%90%E7%A7%91%E5%A4%A7%E6%B8%85%E6%B0%B4%E6%B2%B3%E6%A0%A1%E5%8C%BA%E7%94%A8%E6%88%B7%E7%BB%84; EPORTAL_COOKIE_SERVER_NAME=; JSESSIONID=06FB1A96D12160A5E783BC79DB1F004C; JSESSIONID=748075FE982D90B1116C701351160002&#x27; \</span><br><span class="line">  -H &#x27;Origin: http://172.25.249.70&#x27; \</span><br><span class="line">  -H &#x27;Referer: http://172.25.249.70/eportal/index.jsp?userip=100.66.199.207&amp;wlanacname=&amp;nasip=171.88.130.251&amp;wlanparameter=5c-02-14-ed-50-75&amp;url=http://123.123.123.123/&amp;userlocation=ethtrunk/2:281.405&#x27; \</span><br><span class="line">  -H &#x27;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36&#x27; \</span><br><span class="line">  --data-raw &#x27;userId=宽带账号&amp;password=宽带密码&amp;service=&amp;queryString=userip%253D100.66.199.207%2526wlanacname%253D%2526nasip%253D171.88.130.251%2526wlanparameter%253D5c-02-14-ed-50-75%2526url%253Dhttp%253A%252F%252F123.123.123.123%252F%2526userlocation%253Dethtrunk%252F2%253A281.405&amp;operatorPwd=&amp;operatorUserId=&amp;validcode=&amp;passwordEncrypt=true&#x27; \</span><br><span class="line">  --insecure</span><br></pre></td></tr></table></figure>
</li>
<li><p>用这个来构造永久使用的cURL</p>
<ul>
<li><p>-H的部分是http request header里面的，可以进行一些修改和删除</p>
<ul>
<li><p>例如修改-H User-Agent可以把电脑进行伪装。例如把这个改为以下代码来伪装成Windows电脑：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-H &#x27;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.0.0 Safari/537.36 Edg/93.0.961.0&#x27;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>–data这里需要重点关注，根据抓到的请求，<code>userId=</code> 后是我们的宽带账号，<code>password=</code> 后是我们的宽带密码。同时，后面的 <code>userip%253D</code> 后是我们获得的内网 IP，<code>wlanparameter%253D</code> 后是我们设备的 MAC 地址。为了构造可永久使用的 cURL，首先要确保宽带账号、宽带密码是正确的。最后需要处理的，就是内网 IP 和设备 MAC 地址的问题。</p>
</li>
</ul>
</li>
<li><p>在路由器的系统上获得内网ip：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig | grep inet | grep -v inet6 | grep -v 127 | grep -v 192 | awk &#x27;&#123;print $(NF-2)&#125;&#x27; | cut -d &#x27;:&#x27; -f2</span><br></pre></td></tr></table></figure>
</li>
<li><p>在路由器的系统上获得mac地址：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig ra0 | grep HWaddr | awk &#x27;&#123;print $NF&#125;&#x27; | tr &#x27;[:upper:]&#x27; &#x27;[:lower:]&#x27; | tr &#x27;:&#x27; &#x27;-&#x27;</span><br></pre></td></tr></table></figure>
</li>
<li><p>构造请求</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CURRENT_IP=$(ifconfig | grep inet | grep -v inet6 | grep -v 127 | grep -v 192 | awk &#x27;&#123;print $(NF-2)&#125;&#x27; | cut -d &#x27;:&#x27; -f2)</span><br><span class="line"></span><br><span class="line">MAC_ADDRESS=$(ifconfig ra0 | grep HWaddr | awk &#x27;&#123;print $NF&#125;&#x27; | tr &#x27;[:upper:]&#x27; &#x27;[:lower:]&#x27; | tr &#x27;:&#x27; &#x27;-&#x27;)</span><br><span class="line"></span><br><span class="line">curl -X POST &quot;http://172.25.249.70/eportal/InterFace.do?method=login&quot; -H &quot;Accept: */*&quot; -H &quot;Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6&quot; -H &quot;Connection: keep-alive&quot; -H &quot;Content-Type: application/x-www-form-urlencoded; charset=UTF-8&quot; -H &quot;Cookie: EPORTAL_COOKIE_USERNAME=宽带账号; EPORTAL_COOKIE_SERVER=; EPORTAL_COOKIE_DOMAIN=; EPORTAL_COOKIE_SAVEPASSWORD=true; EPORTAL_COOKIE_OPERATORPWD=; EPORTAL_COOKIE_NEWV=true; EPORTAL_COOKIE_PASSWORD=宽带密码; EPORTAL_AUTO_LAND=; EPORTAL_USER_GROUP=%E7%94%B5%E5%AD%90%E7%A7%91%E5%A4%A7%E6%B8%85%E6%B0%B4%E6%B2%B3%E6%A0%A1%E5%8C%BA%E7%94%A8%E6%88%B7%E7%BB%84; EPORTAL_COOKIE_SERVER_NAME=; JSESSIONID=06FB1A96D12160A5E783BC79DB1F004C; JSESSIONID=748075FE982D90B1116C701351160002&quot; -H &quot;Origin: http://172.25.249.70&quot; -H &quot;Referer: http://172.25.249.70/eportal/index.jsp?userip=$&#123;CURRENT_IP&#125;&amp;wlanacname=&amp;nasip=171.88.130.251&amp;wlanparameter=$&#123;MAC_ADDRESS&#125;&amp;url=http://123.123.123.123/&amp;userlocation=ethtrunk/2:281.405&quot; -H &quot;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36&quot; --data-raw &quot;userId=宽带账号&amp;password=宽带密码&amp;service=&amp;queryString=userip%253D$&#123;CURRENT_IP&#125;%2526wlanacname%253D%2526nasip%253D171.88.130.251%2526wlanparameter%253D$&#123;MAC_ADDRESS&#125;%2526url%253Dhttp%253A%252F%252F123.123.123.123%252F%2526userlocation%253Dethtrunk%252F2%253A281.405&amp;operatorPwd=&amp;operatorUserId=&amp;validcode=&amp;passwordEncrypt=true&quot;</span><br></pre></td></tr></table></figure>

<p>在这里，我们用变量 <code>CURRENT_IP</code> 存储获得的内网 IP，用变量 <code>MAC_ADDRESS</code> 存储获得的 MAC 地址，并在 curl 命令中进行了替换。需要注意的是，要在 bash 命令的引号中使用变量的话，引号必须为<strong>双引号</strong>，而不能采用由 Chrome 复制得来的单引号。</p>
</li>
<li><p>测试</p>
<p>先断开认证，再进行测试</p>
<p>打开mac终端，输入上面构造的三条命令。在mac上进行测试的时候没有成功。显示：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;userIndex&quot;:null,&quot;result&quot;:&quot;fail&quot;,&quot;message&quot;:&quot;设备未注册,请在ePortal上添加认证设备&quot;,&quot;forwordurl&quot;:null,&quot;keepaliveInterval&quot;:0,&quot;validCodeUrl&quot;:&quot;&quot;&#125;%  </span><br></pre></td></tr></table></figure>

<p>应该是获取的ip和mac地址有问题，如果我不用动态获取的而是用原本的cURL里面的ip和mac地址就可以，不知道为什么。</p>
<p>在openwrt上测试一下，成功，所以应该就是抓取的问题：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;userIndex&quot;:&quot;38396661336264646362666631666631626434656438646638656535353832335f3130302e36362e3139392e3230375f3139313032383437343639&quot;,&quot;result&quot;:&quot;success&quot;,&quot;message&quot;:&quot;&quot;,&quot;forwordurl&quot;:null,&quot;keepaliveInterval&quot;:0,&quot;validCodeUrl&quot;:&quot;&quot;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<h3 id="测试链接是否可用（get方法的request）"><a href="#测试链接是否可用（get方法的request）" class="headerlink" title="测试链接是否可用（get方法的request）"></a>测试链接是否可用（get方法的request）</h3><p>先退出认证账号，使网络不可用，</p>
<p>键盘按住win+r键 输入cmd 回车 在弹出的命令窗口中输入curl 链接 回车 如果网络恢复链接，则说明连接可用，可以进行下一步</p>
</blockquote>
<h3 id="3-2-两种自动登录实现思路"><a href="#3-2-两种自动登录实现思路" class="headerlink" title="3.2 两种自动登录实现思路"></a>3.2 两种自动登录实现思路</h3><ul>
<li>一是将设置自动登陆脚本，并设置为开机自动执行，这样再给路由器设置定时重启任务，路由器会在重启后自动登录网页。该方案适用于固定时间掉线的网络环境，例如有的单位是每天晚上1点自动掉线，这种方案比较简单好用。参见第3.3部分。</li>
<li>第二种思路是每隔一段时间检测网络是否掉线，掉线了就自动执行登陆脚本，这种方案更加灵活。参见第3.4部分。</li>
</ul>
<h3 id="3-3-定时重启自动登录网页认证功能（get方法的http-request，未测试）"><a href="#3-3-定时重启自动登录网页认证功能（get方法的http-request，未测试）" class="headerlink" title="3.3 定时重启自动登录网页认证功能（get方法的http request，未测试）"></a>3.3 定时重启自动登录网页认证功能（get方法的http request，未测试）</h3><h4 id="3-3-1-使用ssh连接路由器"><a href="#3-3-1-使用ssh连接路由器" class="headerlink" title="3.3.1 使用ssh连接路由器"></a>3.3.1 使用ssh连接路由器</h4><p>这里使用的Termius，还是ip为：192.168.6.1，用户名：root，密码：password。</p>
<h4 id="3-3-2-写入脚本"><a href="#3-3-2-写入脚本" class="headerlink" title="3.3.2 写入脚本"></a>3.3.2 写入脚本</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir autologin</span><br><span class="line">cd autologin</span><br><span class="line">vi autologin.sh</span><br></pre></td></tr></table></figure>

<p>输入i进入编辑模式，然后输入 curl “链接”。按esc，然后输入“:wq”保存并退出。</p>
<p>输入 sh autologin.sh 测试是否成功（先退出网页登陆，运行改步骤后网络恢复则说明脚本没有问题，如果出现 curl not found，需要将路由器连接外网后在openwrt中搜索安装curl，或者在ssh下依次输入 opkg update 和 opkg install curl）</p>
<h4 id="3-3-3-设置开机启动"><a href="#3-3-3-设置开机启动" class="headerlink" title="3.3.3 设置开机启动"></a>3.3.3 设置开机启动</h4><p>在路由器的启动任务中输入 sh root&#x2F;autologin&#x2F;autologin.sh,如下图所示，这样路由器每次重启就会自动登录。</p>
<h4 id="3-3-4-设置路由器自动重启"><a href="#3-3-4-设置路由器自动重启" class="headerlink" title="3.3.4 设置路由器自动重启"></a>3.3.4 设置路由器自动重启</h4><p>在Scheduled Tasks中加入如下代码即可实现每天5：10分重启路由器，有其他的需求的搜索“corn语法”，根据说明进行修改。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10 5 * * * sleep 70 &amp;&amp; touch /etc/banner &amp;&amp; reboot   //每天5点10分路由器自动重启</span><br></pre></td></tr></table></figure>

<p>保存上述脚本后，注意在启动项里重启一下corn，或者直接重启一下路由器，在重启路由器之前注意检查路由器时区是否正确，如果时区不正确还需要手动修改时区到亚洲&#x2F;上海。</p>
<p>至此路由器即实现了每天五点十分重启，并且重启后自动登录网页认证。</p>
<h3 id="3-4-自动检测并登录功能（post方法的http-request，-成功）"><a href="#3-4-自动检测并登录功能（post方法的http-request，-成功）" class="headerlink" title="3.4 自动检测并登录功能（post方法的http request， 成功）"></a>3.4 自动检测并登录功能（post方法的http request， 成功）</h3><h4 id="3-4-1-使用ssh连接路由器"><a href="#3-4-1-使用ssh连接路由器" class="headerlink" title="3.4.1 使用ssh连接路由器"></a>3.4.1 使用ssh连接路由器</h4><p>这里使用的Termius，还是ip为：192.168.6.1，用户名：root，密码：password。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">┌─────────────────────────────────────────────┐</span><br><span class="line">│                                             │</span><br><span class="line">│ mmmmm                         m       &quot;&quot;#   │</span><br><span class="line">│   #   mmmmm mmmmm  mmm  mmm mm#mm  mmm  #   │</span><br><span class="line">│   #   # # # # # # #&quot; &quot;# #&quot; &quot;  #   &quot;   # #   │</span><br><span class="line">│   #   # # # # # # #   # #     #   m&quot;&quot;&quot;# #   │</span><br><span class="line">│ mm#mm # # # # # # &quot;#m#&quot; #     &quot;mm &quot;mm&quot;# &quot;mm │</span><br><span class="line">│                                             │</span><br><span class="line">│─────────────────────────────────────────────│</span><br><span class="line">│              ImmortalWrt 18.06              │</span><br><span class="line">└─────────────────────────────────────────────┘</span><br></pre></td></tr></table></figure>

<h4 id="3-4-2-创建脚本"><a href="#3-4-2-创建脚本" class="headerlink" title="3.4.2 创建脚本"></a>3.4.2 创建脚本</h4><p><strong>sh脚本（shell script）是一种使用shell命令编写的脚本文件，适用于Unix&#x2F;Linux系统，包括OpenWrt。</strong></p>
<p>脚本的流程为，具体实现看仓库里的ping.sh：</p>
<ol>
<li>初始化网络检测次数、等待时间、重登录尝试次数和日志路径。</li>
<li>定义<code>check_network</code>函数，用于ping检测网络是否正常。</li>
<li>定义<code>log</code>函数，用于记录日志信息。</li>
<li>定义<code>perform_login</code>函数，用于执行网络登录操作。</li>
<li>进入无限循环，循环体内：<ul>
<li>使用<code>check_network</code>检查网络状态。</li>
<li>如果网络正常，记录日志并退出循环。</li>
<li>如果网络异常，增加ping尝试计数，并在达到设定次数后尝试重新登录。</li>
<li>如果重新登录尝试达到限制次数网络仍未恢复，执行设备重启操作。</li>
</ul>
</li>
<li>循环中每隔设定的等待时间再次检查网络状态。</li>
</ol>
<h4 id="3-4-3-上传登录脚本到路由器"><a href="#3-4-3-上传登录脚本到路由器" class="headerlink" title="3.4.3 上传登录脚本到路由器"></a>3.4.3 上传登录脚本到路由器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@ImmortalWrt:~# mkdir ping</span><br><span class="line">root@ImmortalWrt:~# cd ping</span><br><span class="line">root@ImmortalWrt:~/ping# vi ping.sh</span><br></pre></td></tr></table></figure>

<p>把代码复制进去然后esc，:wq退出</p>
<h4 id="3-4-4-测试脚本是否正常"><a href="#3-4-4-测试脚本是否正常" class="headerlink" title="3.4.4 测试脚本是否正常"></a>3.4.4 测试脚本是否正常</h4><p>可以输入 sh ping.sh 测试是否成功（先退出网页登陆，运行该步骤后网络恢复则说明脚本没有问题，如果出现 curl not found，需要将路由器连接外网后在openwrt中搜索安装curl，或者在ssh下依次输入 opkg update 和 opkg install curl）</p>
<p>结果成功！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@ImmortalWrt:~/ping# sh ping.sh</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">[1/3] Network maybe disconnected, checking again after 10 seconds!</span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">[2/3] Network maybe disconnected, checking again after 10 seconds!</span></span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">[3/3] Network maybe disconnected, checking again after 10 seconds!</span></span><br><span class="line">try to re-login</span><br><span class="line">&#123;&quot;userIndex&quot;:&quot;38396661336264646362666631666631626434656438646638656535353832335f3130302e36362e3139392e3230375f3139313032383437343639&quot;,&quot;result&quot;:&quot;success&quot;,&quot;message&quot;:&quot;&quot;,&quot;forwordurl&quot;:null,&quot;keepaliveInterval&quot;:0,&quot;validCodeUrl&quot;:&quot;&quot;&#125;登录成功</span><br><span class="line">network is ok</span><br><span class="line">root@ImmortalWrt:~/ping# </span><br></pre></td></tr></table></figure>

<p>给脚本增加执行权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ImmortalWrt:~/ping# ls -l ping.sh </span><br><span class="line">-rw-r--r--    1 root     root          4135 Aug  4 00:27 ping.sh</span><br><span class="line">root@ImmortalWrt:~/ping# chmod +x ping.sh </span><br><span class="line">root@ImmortalWrt:~/ping# ls -l ping.sh </span><br><span class="line">-rwxr-xr-x    1 root     root          4135 Aug  4 00:27 ping.sh</span><br><span class="line">root@ImmortalWrt:~/ping# </span><br></pre></td></tr></table></figure>

<h4 id="3-4-5-设置定时任务"><a href="#3-4-5-设置定时任务" class="headerlink" title="3.4.5 设置定时任务"></a>3.4.5 设置定时任务</h4><p><strong>计划任务（Corn）是 Unix 和 类Unix 系统中一个常见的功能，用于设置周期性的被执行的命令。</strong></p>
<p>计划任务的每个任务被存储在<code>corntab</code>文件中。在正常的 Linux 系统下，每个用户对应一 corntab 个文件，还有一个针对整个系统的 corntab 文件。不过在 OpenWrt，只有针对于整个系统的 corntab 文件，位于<code>/etc/corntab/root</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@ImmortalWrt:~/ping# cd /etc</span><br><span class="line">root@ImmortalWrt:/etc# cd crontabs/</span><br><span class="line">root@ImmortalWrt:/etc/crontabs# ls</span><br><span class="line">cron.update  root</span><br><span class="line">root@ImmortalWrt:/etc/crontabs# vi root </span><br></pre></td></tr></table></figure>

<p>在这个文件里面添加计划，表示20分钟检查一次：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/20 * * * * /root/ping/ping.sh</span><br></pre></td></tr></table></figure>

<p>具体参数含义为：</p>
<ul>
<li><code>*/20</code> 表示每20分钟。</li>
<li><code>*</code> 表示每小时的每个分钟。</li>
<li><code>*</code> 表示每天的每个小时。</li>
<li><code>*</code> 表示每月的每天。</li>
<li><code>*</code> 表示每周的每一天。</li>
</ul>
<p><code>/root/ping/ping.sh</code>是你的脚本实际存放的路径。确保替换成你的脚本实际路径。</p>
<p>其他设置方法可以用<a target="_blank" rel="noopener" href="https://crontab.guru/">这个网站</a>来设置。</p>
<p>然后需要重新启动corn服务：</p>
<ul>
<li><p>打开路由器的后台，选择 系统-计划任务，看到刚才写的任务在这里出现。</p>
</li>
<li><p>选择系统-启动项</p>
</li>
<li><p>找到corn，点击重启，即可完成</p>
</li>
</ul>
<h4 id="3-4-6-测试定时任务是否正常"><a href="#3-4-6-测试定时任务是否正常" class="headerlink" title="3.4.6 测试定时任务是否正常"></a>3.4.6 测试定时任务是否正常</h4><p>先把任务改成每两分钟执行一次，然后断开网络认证，进行测试，结果没有问题：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">2024-08-04 01:04:00network is ok</span><br><span class="line">2024-08-04 01:06:02-&gt; [1/3] Network maybe disconnected, checking again after 10 seconds!</span><br><span class="line">2024-08-04 01:06:14-&gt; [2/3] Network maybe disconnected, checking again after 10 seconds!</span><br><span class="line">2024-08-04 01:06:26-&gt; [3/3] Network maybe disconnected, checking again after 10 seconds!</span><br><span class="line">2024-08-04 01:06:26try to re-login</span><br><span class="line">2024-08-04 01:06:27............</span><br><span class="line">2024-08-04 01:06:45network is ok</span><br><span class="line">2024-08-04 01:08:00network is ok</span><br><span class="line">2024-08-04 01:10:00network is ok</span><br><span class="line">2024-08-04 01:12:00network is ok</span><br><span class="line">2024-08-04 01:14:00network is ok</span><br></pre></td></tr></table></figure>

<p>再把任务定时改回20分钟，进行测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2024-08-04 01:14:00network is ok</span><br><span class="line">2024-08-04 01:20:00network is ok</span><br><span class="line">2024-08-04 01:40:00network is ok</span><br></pre></td></tr></table></figure>

<p>经过测试并没有问题</p>
<p>至此已经实现了路由器自动登录网页认证的功能！！</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://brucewayne9064.github.io">Bruce</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://brucewayne9064.github.io/2024/08/16/%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/%E8%BD%AF%E8%B7%AF%E7%94%B1%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99%E4%BD%BF%E7%94%A8/">https://brucewayne9064.github.io/2024/08/16/%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/%E8%BD%AF%E8%B7%AF%E7%94%B1%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91%E5%92%8C%E8%87%AA%E5%8A%A8%E5%8C%96%E8%84%9A%E6%9C%AC%E7%BC%96%E5%86%99%E4%BD%BF%E7%94%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://brucewayne9064.github.io" target="_blank">BRUCE</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/linux/">linux</a><a class="post-meta__tags" href="/tags/%E8%BD%AF%E8%B7%AF%E7%94%B1/">软路由</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/18/java/java%E7%9F%A5%E8%AF%86%E7%82%B9%E7%B4%A2%E5%BC%95/" title="java知识点索引"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">java知识点索引</div></div></a></div><div class="next-post pull-right"><a href="/2024/07/01/mysql/INNODB_TX_ISOL/" title="InnoDB存储引擎的事务隔离级别以及实现方法"><img class="cover" src="/img/post/mysql.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">InnoDB存储引擎的事务隔离级别以及实现方法</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/03/01/cpp/C-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="【c++笔记】void*指针和main()参数"><img class="cover" src="/img/post/cpp.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-01</div><div class="title">【c++笔记】void*指针和main()参数</div></div></a></div><div><a href="/2023/08/21/redis%E7%9B%B8%E5%85%B3/redis/" title="【笔记】redis设计与实现"><img class="cover" src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-21</div><div class="title">【笔记】redis设计与实现</div></div></a></div><div><a href="/2023/04/27/mysql/mysql_quick_guide/" title="【读书笔记】mysql必知必会"><img class="cover" src="/img/post/mysql.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-27</div><div class="title">【读书笔记】mysql必知必会</div></div></a></div><div><a href="/2024/04/20/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/%E7%BA%A2%E9%BB%91%E6%A0%91%E5%BA%94%E7%94%A8%E4%B9%8BLinux%E5%86%85%E6%A0%B8/" title="红黑树应用之Linux内核"><img class="cover" src="/img/post/rbtree/rbt_logof60f534cdfbb5f38923ae1fc56d1dd18.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-20</div><div class="title">红黑树应用之Linux内核</div></div></a></div><div><a href="/2023/04/27/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/HTTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/" title="【网络编程项目1】HTTP服务器编程"><img class="cover" src="/img/post/starlink.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-27</div><div class="title">【网络编程项目1】HTTP服务器编程</div></div></a></div><div><a href="/2023/03/20/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/TCP%E7%BC%96%E7%A8%8B/" title="【网络编程2】TCP编程"><img class="cover" src="/img/post/starlink.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-20</div><div class="title">【网络编程2】TCP编程</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/sanji_avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Bruce</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">23</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/brucewayne9064"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/brucewayne9064" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:906491934@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="https://leetcode.cn/u/bruce-nz/" target="_blank" title="LeetCode"><i class="fas fa-code"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%BB%99%E8%B7%AF%E7%94%B1%E5%99%A8%E5%88%B7%E5%85%A5openwrt"><span class="toc-number">1.</span> <span class="toc-text">1. 给路由器刷入openwrt</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%87%86%E5%A4%87%E5%B7%A5%E5%85%B7"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 准备工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%88%B7%E6%9C%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 刷机过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E9%85%8D%E7%BD%AE%E7%BF%BB%E5%A2%99"><span class="toc-number">2.</span> <span class="toc-text">2.配置翻墙</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%88%B7%E5%85%A5%E7%9A%84%E5%9B%BA%E4%BB%B6%E8%87%AA%E5%B8%A6openclash"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 刷入的固件自带openclash</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%88%B7%E5%85%A5%E7%9A%84%E5%9B%BA%E4%BB%B6%E6%B2%A1%E6%9C%89openclash%EF%BC%88%E6%B2%A1%E6%9C%89%E9%AA%8C%E8%AF%81%E6%88%90%E5%8A%9F%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 刷入的固件没有openclash（没有验证成功）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%A0%A1%E5%9B%AD%E7%BD%91%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95"><span class="toc-number">3.</span> <span class="toc-text">3. 校园网自动登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%8A%93%E5%8F%96%E7%99%BB%E5%BD%95%E9%93%BE%E6%8E%A5"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 抓取登录链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E9%93%BE%E6%8E%A5%E6%98%AF%E5%90%A6%E5%8F%AF%E7%94%A8%EF%BC%88get%E6%96%B9%E6%B3%95%E7%9A%84request%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">测试链接是否可用（get方法的request）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E4%B8%A4%E7%A7%8D%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="toc-number">3.3.</span> <span class="toc-text">3.2 两种自动登录实现思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%AE%9A%E6%97%B6%E9%87%8D%E5%90%AF%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95%E7%BD%91%E9%A1%B5%E8%AE%A4%E8%AF%81%E5%8A%9F%E8%83%BD%EF%BC%88get%E6%96%B9%E6%B3%95%E7%9A%84http-request%EF%BC%8C%E6%9C%AA%E6%B5%8B%E8%AF%95%EF%BC%89"><span class="toc-number">3.4.</span> <span class="toc-text">3.3 定时重启自动登录网页认证功能（get方法的http request，未测试）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E4%BD%BF%E7%94%A8ssh%E8%BF%9E%E6%8E%A5%E8%B7%AF%E7%94%B1%E5%99%A8"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.3.1 使用ssh连接路由器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-%E5%86%99%E5%85%A5%E8%84%9A%E6%9C%AC"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.3.2 写入脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8"><span class="toc-number">3.4.3.</span> <span class="toc-text">3.3.3 设置开机启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-%E8%AE%BE%E7%BD%AE%E8%B7%AF%E7%94%B1%E5%99%A8%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF"><span class="toc-number">3.4.4.</span> <span class="toc-text">3.3.4 设置路由器自动重启</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E8%87%AA%E5%8A%A8%E6%A3%80%E6%B5%8B%E5%B9%B6%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%EF%BC%88post%E6%96%B9%E6%B3%95%E7%9A%84http-request%EF%BC%8C-%E6%88%90%E5%8A%9F%EF%BC%89"><span class="toc-number">3.5.</span> <span class="toc-text">3.4 自动检测并登录功能（post方法的http request， 成功）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-1-%E4%BD%BF%E7%94%A8ssh%E8%BF%9E%E6%8E%A5%E8%B7%AF%E7%94%B1%E5%99%A8"><span class="toc-number">3.5.1.</span> <span class="toc-text">3.4.1 使用ssh连接路由器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-2-%E5%88%9B%E5%BB%BA%E8%84%9A%E6%9C%AC"><span class="toc-number">3.5.2.</span> <span class="toc-text">3.4.2 创建脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-3-%E4%B8%8A%E4%BC%A0%E7%99%BB%E5%BD%95%E8%84%9A%E6%9C%AC%E5%88%B0%E8%B7%AF%E7%94%B1%E5%99%A8"><span class="toc-number">3.5.3.</span> <span class="toc-text">3.4.3 上传登录脚本到路由器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-4-%E6%B5%8B%E8%AF%95%E8%84%9A%E6%9C%AC%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8"><span class="toc-number">3.5.4.</span> <span class="toc-text">3.4.4 测试脚本是否正常</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-5-%E8%AE%BE%E7%BD%AE%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">3.5.5.</span> <span class="toc-text">3.4.5 设置定时任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-6-%E6%B5%8B%E8%AF%95%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8"><span class="toc-number">3.5.6.</span> <span class="toc-text">3.4.6 测试定时任务是否正常</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/21/%E6%B1%82%E8%81%8C/2025%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/" title="无题">无题</a><time datetime="2024-12-21T09:00:48.051Z" title="发表于 2024-12-21 17:00:48">2024-12-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/21/%E6%B1%82%E8%81%8C/2025%E6%9A%91%E6%9C%9F%E5%AE%9E%E4%B9%A0%E5%92%8C%E7%A7%8B%E5%AD%A3%E6%8B%9B%E8%81%98%E5%88%86%E6%9E%90%E6%80%BB%E7%BB%93/" title="无题">无题</a><time datetime="2024-12-21T08:57:51.487Z" title="发表于 2024-12-21 16:57:51">2024-12-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/13/mysql/MySQL_index/" title="MySQL索引">MySQL索引</a><time datetime="2024-09-12T19:52:38.000Z" title="发表于 2024-09-13 03:52:38">2024-09-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/25/java/%E3%80%90java%E7%AC%94%E8%AE%B0%E3%80%91%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/" title="【java笔记】进程和线程">【java笔记】进程和线程</a><time datetime="2024-08-25T13:07:00.000Z" title="发表于 2024-08-25 21:07:00">2024-08-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/19/java/%E3%80%90java%E7%AC%94%E8%AE%B0%E3%80%91%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%BA%94%E7%A7%8D%E6%96%B9%E5%BC%8F/" title="【java笔记】创建对象的五种方式">【java笔记】创建对象的五种方式</a><time datetime="2024-08-18T17:21:00.000Z" title="发表于 2024-08-19 01:21:00">2024-08-19</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Bruce</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container').forEach(node => {
            if (node.hasAttribute('display')) {
              btf.wrap(node, 'div', { class: 'mathjax-overflow' })
            } else {
              btf.wrap(node, 'span', { class: 'mathjax-overflow' })
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>